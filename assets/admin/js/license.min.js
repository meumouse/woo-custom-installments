!function(e){"use strict";const t=window.wci_license_params||{};var s={keepButtonState:function(e){var t=e.width(),s=e.height(),a=e.html();return e.width(t),e.height(s),{width:t,height:s,html:a}},hideToasts:function(){e(document).on("click",".hide-toast",(function(){e(".toast").fadeOut("fast")})),setTimeout((function(){e(".toast").fadeOut("fast")}),3e3)},displayToast:function(s,a,n){"error"===s&&(s="danger");const o=`<div class="toast toast-${s} show">\n\t\t\t\t<div class="toast-header bg-${s} text-white">\n\t\t\t\t\t<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>\n\t\t\t\t\t<span class="me-auto">${a}</span>\n\t\t\t\t\t<button class="btn-close btn-close-white ms-2 hide-toast" type="button" aria-label="${t.i18n.aria_label_modal}"></button>\n\t\t\t\t</div>\n\t\t\t\t<div class="toast-body">${n}</div>\n\t\t\t</div>`;e(".woo-custom-installments-tab-wrapper").before(o),setTimeout((()=>{e(`.toast-${s}`).fadeOut("fast",(function(){e(this).remove()}))}),3e3)},activateLicense:function(){e("#woo_custom_installments_active_license").on("click",(function(a){a.preventDefault();let n=e(this),o=s.keepButtonState(n);e.ajax({url:t.ajax_url,method:"POST",data:{action:"wci_active_license",license_key:e("#woo_custom_installments_license_key").val()},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(e){try{"success"===e.status?(s.displayToast("success",e.toast_header_title,e.toast_body_title),setTimeout((function(){location.reload()}),1e3)):s.displayToast("error",e.toast_header_title,e.toast_body_title)}catch(e){console.log(e)}},complete:function(){n.prop("disabled",!1).html(o.html)},error:function(e,t,s){alert("AJAX error: "+s)}})}))},deactivateLicense:function(){e(document).on("click","#woo_custom_installments_deactive_license",(function(a){if(a.preventDefault(),!confirm(t.i18n.confirm_deactivate_license))return;let n=e(this),o=s.keepButtonState(n);e.ajax({url:t.ajax_url,type:"POST",data:{action:"wci_deactive_license_action"},beforeSend:function(){n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(e){try{"success"===e.status?(n.html(o.html),s.displayToast("warning",e.toast_header_title,e.toast_body_title),setTimeout((()=>{location.reload()}),1e3)):(n.html(o.html),s.displayToast("danger",e.toast_header_title,e.toast_body_title))}catch(e){console.log(e)}},error:function(e,t,s){console.error("AJAX Error:",t,s)}})}))},handleLicenseUpload:function(){const t=e("#license_key_zone"),a=e("#upload_license_key");t.on("dragover dragleave",(function(t){t.preventDefault(),e(this).toggleClass("drag-over","dragover"===t.type)})),t.on("drop",(function(t){t.preventDefault();const a=t.originalEvent.dataTransfer.files[0];e(this).hasClass("file-uploaded")||s.processLicenseFile(a,e(this))})),a.on("change",(function(e){const t=e.target.files[0];s.processLicenseFile(t,a.parents(".dropzone-license"))}))},processLicenseFile:function(a,n){if(!a)return;const o=a.name,i=new FormData;i.append("action","wci_alternative_activation_license"),i.append("file",a),n.children(".file-list").removeClass("d-none").text(o),n.addClass("file-processing"),n.append('<div class="spinner-border"></div>'),n.children(".drag-text, .drag-and-drop-file, .upload-license-key").addClass("d-none"),e.ajax({url:t.ajax_url,type:"POST",data:i,processData:!1,contentType:!1,success:function(e){try{"success"===e.status?(s.displayToast("success",e.toast_header,e.toast_body),n.addClass("file-uploaded").removeClass("file-processing").children(".spinner-border").remove(),n.append(`<div class="upload-notice d-flex flex-column align-items-center"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="#22c55e" d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path fill="#22c55e" d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg><span>${e.dropfile_message}</span></div>`),n.children(".file-list").addClass("d-none"),setTimeout((()=>{location.reload()}),1e3)):(s.displayToast("error",e.toast_header,e.toast_body),n.addClass("invalid-file").removeClass("file-processing"),n.children(".spinner-border").remove(),n.children(".drag-text, .drag-and-drop-file, .upload-license-key").removeClass("d-none"),n.children(".file-list").addClass("d-none"))}catch(e){console.log(e)}},error:function(e,t,s){n.addClass("fail-upload").removeClass("file-processing"),console.error("AJAX Error:",t,s)}})},init:function(){this.hideToasts(),this.activateLicense(),this.deactivateLicense(),this.handleLicenseUpload()}};e(document).ready((function(){s.init()}))}(jQuery);