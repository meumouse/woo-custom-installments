!function(e){"use strict";const t=window.wci_front_params||{};t.dev_mode&&console.log("Woo Custom Installments: Front scripts loaded.",t);var n={old_price:t.product.regular_price?t.product.regular_price:0,new_price:t.product.current_price||0},i=1,o={initAccordion:function(){e(document).on("click",".wci-accordion-header",o.toggleAccordion.bind(this))},toggleAccordion:function(t){var n=e(t.currentTarget).next(".wci-accordion-content");"0px"===n.css("max-height")?(n.css("max-height",n.prop("scrollHeight")+"px"),n.parent(".wci-accordion-item").addClass("active"),e("body").addClass("wci-accordion-active")):n.slideUp(350,(function(){n.parent(".wci-accordion-item").removeClass("active"),n.css("display",""),n.css("max-height","0px"),e("body").removeClass("wci-accordion-active")}))},displayModal:function(t,n,i){e(document).on("click touchstart",t,(function(t){t.preventDefault(),e(this).siblings(".wci-popup-container").addClass("show"),e("body").addClass("wci-modal-active")})),e(document).on("click touchstart",n,(function(t){t.target===this&&(e(this).removeClass("show"),e("body").removeClass("wci-modal-active"))})),e(document).on("click touchstart",i,(function(t){t.preventDefault(),e(".wci-popup-container").removeClass("show"),e("body").removeClass("wci-modal-active")}))},initModal:function(){o.displayModal(".wci-open-popup",".wci-popup-container",".wci-close-popup")},replaceRangePrice:function(){t.product_variation_with_range&&t.license_valid?(e(document).on("found_variation show_variation","form.variations_form",(function(e,t){o.rangeHandleVariationEvent(t)})),e(document).on("change",'input[name="variation_id"]',(function(){let t=e(this).val();o.rangeUpdatePrice(t)})),e(document).on("click","a.reset_variation, a.reset_variations",(function(){o.rangeOnClearVariations()})),(t.element_triggers||"").split(",").forEach(function(t){e(t.trim()).on("click touchstart change",o.rangeOnTriggerEvent.bind(this))}.bind(this))):t.debug_mode&&console.log("Woo Custom Installments: Range price is disabled.")},rangeOnClearVariations:function(){let t=e(".woo-custom-installments-price-container"),n=t.siblings(".woo-custom-installments-group");t.removeClass("active").addClass("d-none").html(""),n.removeClass("d-none")},rangeOnTriggerEvent:function(){e(document).on("found_variation show_variation","form.variations_form",(function(e,t){o.rangeHandleVariationEvent(t)}))},rangeHandleVariationEvent:function(e){e&&e.variation_id&&(o.rangeUpdatePrice(e.variation_id),n={old_price:e.display_regular_price,new_price:e.display_price},o.updateAmounts(n,i))},rangeUpdatePrice:function(t){let n=e("#wci-variation-prices").find(`.wci-variation-item[data-variation-id="${t}"]`).html();e(".woo-custom-installments-price-container").html(n).addClass("active").removeClass("d-none"),o.rangePreventDuplicatePrices()},rangePreventDuplicatePrices:function(){let t=e(".woo-custom-installments-price-container"),n=t.siblings(".woo-custom-installments-group");t.hasClass("active")&&""!==t.html().trim()?n.addClass("d-none"):(t.removeClass("active"),n.removeClass("d-none"))},updateQuantity:function(){e(document).on("change",'input[name="quantity"]',(function(){i=parseInt(e(this).val())||1,t.tiered_get_rules&&"object"==typeof t.tiered_get_rules&&Object.keys(t.tiered_get_rules).length>0||o.updateAmounts(n,i)}))},updateAmounts:function(n={},i=1){t.dev_mode&&console.log("Woo Custom Installments: Updating amounts with price:",n,"and quantity:",i);var a=o.getPriceSelector(),c=i;"yes"===t.update_price_with_quantity&&(c=parseInt(i)||e('input[name="quantity"]').val()),o.updateTableInstallments(n.new_price*c);let r={old_price:n.old_price*c,new_price:n.new_price*c};o.updateMainPriceElement(r);let s=t.discounts.enable_discount_per_unit,l=t.discounts.discount_per_unit_method,d=t.discounts.unit_discount_amount,u=t.discounts.pix_discount,m=t.discounts.pix_discount_method,p=0;if(a.find(".woo-custom-installments-offer").length>0)if("yes"===s){if("percentage"===l){let e=o.getPercentageDiscount(d,n.new_price);p=(n.new_price-e)*c,o.updatePixDiscountElement(e*c)}else if("fixed"===l){let e=n.new_price-d;p=(n.new_price-e)*c,o.updatePixDiscountElement(e*c)}}else if(u)if("percentage"===m){let e=o.getPercentageDiscount(u,n.new_price);p=(n.new_price-e)*c,o.updatePixDiscountElement(e*c)}else if("fixed"===m){let e=n.new_price-u;p=(n.new_price-e)*c,o.updatePixDiscountElement(e*c)}let _=t.discounts.slip_bank_discount,f=t.discounts.slip_bank_method;if(a.find(".woo-custom-installments-ticket-discount").length>0)if("percentage"===f){let e=o.getPercentageDiscount(_,n.new_price)*c;o.updateSlipBankElement(e)}else"fixed"===f&&o.updateSlipBankElement((n.new_price-_)*c);a.find(".woo-custom-installments-economy-pix-badge").length>0&&o.updateEconomyElement(p)},getPriceSelector:function(){const n=e(".woo-custom-installments-price-container"),i=n.siblings(".woo-custom-installments-group");return"simple"===t.product.type?i:"yes"===t.active_price_range?n.hasClass("active")?n:i:0===n.length?e(".woocommerce-variation-price").find(".woo-custom-installments-group"):i},updateMainPriceElement:function(e){let t=o.getPriceSelector();t.find(".woo-custom-installments-price.has-discount").length>0?(e.old_price&&t.find(".woo-custom-installments-price.has-discount").find(".amount").html(o.getFormattedPrice(e.old_price)),e.new_price&&t.find(".woo-custom-installments-price.sale-price").find(".amount").html(o.getFormattedPrice(e.new_price))):e.new_price&&t.find(".woo-custom-installments-price").find(".amount").html(o.getFormattedPrice(e.new_price))},updatePixDiscountElement:function(t){o.getPriceSelector().find(".woo-custom-installments-offer").find(".amount").html(o.getFormattedPrice(t)),e(".wci-popup-body").find(".pix-method-container").find(".amount").html(o.getFormattedPrice(t)),e(".wci-accordion-content").find(".pix-method-container").find(".amount").html(o.getFormattedPrice(t))},updateSlipBankElement:function(t){o.getPriceSelector().find(".woo-custom-installments-ticket-discount").find(".amount").html(o.getFormattedPrice(t)),e(".wci-popup-body").find(".woo-custom-installments-ticket-section").find(".amount").html(o.getFormattedPrice(t)),e(".wci-accordion-content").find(".woo-custom-installments-ticket-section").find(".amount").html(o.getFormattedPrice(t))},updateEconomyElement:function(t){o.getPriceSelector().find(".woo-custom-installments-economy-pix-badge").find(".amount").html(o.getFormattedPrice(t)),e(".wci-popup-body").find(".woo-custom-installments-economy-pix-badge").find(".amount").html(o.getFormattedPrice(t)),e(".wci-accordion-content").find(".woo-custom-installments-economy-pix-badge").find(".amount").html(o.getFormattedPrice(t))},getPercentageDiscount:function(e,t){return t-t*(e/100)},updatedTieredPrice:function(){e(document).on("found_variation show_variation","form.variations_form",(function(e,t){n.old_price=t.display_regular_price,n.new_price=t.display_price})),e(document).on("tiered_price_update",(function(e,t){n.new_price=t.price,o.updateAmounts(n,t.quantity)}))},updateTableInstallments:function(n){var i=n,a=e(".woo-custom-installments-table").find("tbody"),c=a.data("default-text");a.html('<tr style="display: none !important;"></tr>');var r=1,s=t.installments.fees,l=o.getPriceSelector();let d=t.i18n.best_installments_sp;for(;r<=t.installments.max_installments;){var u,m=s.hasOwnProperty(r)?s[r]:t.installments.fee;if(r<=t.installments.max_installments_no_fee){if((n=i/r)<t.installments.min_installment)break;if(c&&a.append('<tr class="no-fee"><th>'+c.replace("{{ parcelas }}",r).replace("{{ valor }}",o.getFormattedPrice(n)).replace("{{ juros }}",t.i18n.without_fee_label).replace("{{ total }}",o.getFormattedPrice(n*r))+"</th><th>"+o.getFormattedPrice(i)+"</th></tr>"),d){let e=d.replace("{{ parcelas }}",r).replace("{{ valor }}",o.getFormattedPrice(n)).replace("{{ juros }}",t.i18n.without_fee_label).replace("{{ total }}",o.getFormattedPrice(n*r));l.find(".woo-custom-installments-details.best-value.no-fee").html(e)}}else{if(0===(m=parseFloat(m.toString().replace(",","."))/100))u=i,n=i/r;else if(t.installments.fee!==m)n=(u=i+i*m)/r;else{var p=Math.pow(1+m,r);u=(n=i*m*p/(p-1))*r}if(n<t.installments.min_installment)break;if(c&&a.append('<tr class="fee-included"><th>'+c.replace("{{ parcelas }}",r).replace("{{ valor }}",o.getFormattedPrice(n)).replace("{{ juros }}",t.i18n.with_fee_label).replace("{{ total }}",o.getFormattedPrice(u))+"</th><th>"+o.getFormattedPrice(u)+"</th></tr>"),d){let e=d.replace("{{ parcelas }}",r).replace("{{ valor }}",o.getFormattedPrice(n)).replace("{{ juros }}",t.i18n.with_fee_label).replace("{{ total }}",o.getFormattedPrice(u));l.find(".woo-custom-installments-details-with-fee .best-value.fee-included").html(e)}}t.dev_mode&&(console.log("Fees: ",s),console.log("Price: ",i),console.log("Fee: ",m),console.log("Final cost: ",u)),r++}},getFormattedPrice:function(e){return accounting.formatMoney(e,{symbol:t.currency.symbol,decimal:t.currency.format_decimal_sep,thousand:t.currency.format_thousand_sep,precision:t.currency.format_num_decimals,format:t.currency.format})},init:function(){this.initAccordion(),this.initModal(),n.old_price=t.product.regular_price,n.new_price=t.product.current_price,"variable"===t.product.type&&e(document).on("found_variation show_variation","form.variations_form",(function(e,t){n.old_price=t.display_regular_price,n.new_price=t.display_price})),"yes"===t.active_price_range&&"simple"!==t.product.type&&this.replaceRangePrice(),"yes"===t.update_price_with_quantity&&this.updateQuantity(),t.check_tiered_plugin&&this.updatedTieredPrice()}};jQuery(document).ready((function(e){o.init()})),window.Woo_Custom_Installments=o,jQuery(document).trigger("woo_custom_installments_ready")}(jQuery);