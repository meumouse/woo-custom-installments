!function(e){"use strict";const t=window.wci_front_params||{};t.dev_mode&&console.log("Woo Custom Installments: Front scripts loaded.",t);var n={old_price:t.product.regular_price?t.product.regular_price:0,new_price:t.product.current_price||0},i=1,o=null,a={debounce:function(e,t){clearTimeout(o),o=setTimeout(e,t)},initAccordion:function(){e(document).on("click",".wci-accordion-header",a.toggleAccordion.bind(this))},toggleAccordion:function(t){var n=e(t.currentTarget).next(".wci-accordion-content");"0px"===n.css("max-height")?(n.css("max-height",n.prop("scrollHeight")+"px"),n.parent(".wci-accordion-item").addClass("active"),e("body").addClass("wci-accordion-active")):n.slideUp(350,(function(){n.parent(".wci-accordion-item").removeClass("active"),n.css("display",""),n.css("max-height","0px"),e("body").removeClass("wci-accordion-active")}))},displayModal:function(t,n,i){e(document).on("click touchstart",t,(function(t){t.preventDefault(),e(this).siblings(".wci-popup-container").addClass("show"),e("body").addClass("wci-modal-active")})),e(document).on("click touchstart",n,(function(t){t.target===this&&(e(this).removeClass("show"),e("body").removeClass("wci-modal-active"))})),e(document).on("click touchstart",i,(function(t){t.preventDefault(),e(".wci-popup-container").removeClass("show"),e("body").removeClass("wci-modal-active")}))},initModal:function(){a.displayModal(".wci-open-popup",".wci-popup-container",".wci-close-popup")},replaceRangePrice:function(){if(!t.product_variation_with_range||!t.license_valid)return void(t.debug_mode&&console.log("Woo Custom Installments: Range price is disabled."));let n;e(document).on("found_variation show_variation","form.variations_form",(function(e,t){clearTimeout(n),n=setTimeout((()=>{a.rangeHandleVariationEvent(t)}),50)})),e(document).on("change",'input[name="variation_id"]',(function(){let t=e(this).val();clearTimeout(n),n=setTimeout((()=>{a.rangeUpdatePrice(t)}),50)})),e(document).on("click","a.reset_variation, a.reset_variations",(function(){clearTimeout(n),a.rangeOnClearVariations()}));(t.element_triggers||"").split(",").forEach((function(t){let i=t.trim();i&&e(i).on("click touchstart change",(function(){clearTimeout(n),n=setTimeout((()=>{a.rangeHandleVariationEvent()}),50)}))})),t.debug_mode&&console.log("Woo Custom Installments: Range price initialized with debounce optimization.")},rangeOnClearVariations:function(){let t=e(".woo-custom-installments-price-container"),n=t.siblings(".woo-custom-installments-group");t.removeClass("active").addClass("d-none").html(""),n.removeClass("d-none")},rangeOnTriggerEvent:function(){e(document).on("found_variation show_variation","form.variations_form",(function(e,t){a.rangeHandleVariationEvent(t)}))},rangeHandleVariationEvent:function(e){e&&e.variation_id&&(a.rangeUpdatePrice(e.variation_id),n={old_price:e.display_regular_price,new_price:e.display_price},a.debounce((()=>{a.updateAmounts(n,i)}),100))},rangeUpdatePrice:function(t){const n=e(".woo-custom-installments-price-container"),i=e("#wci-variation-prices").find(`.wci-variation-item[data-variation-id="${t}"]`);i.length&&(n.html(i.html()).addClass("active").removeClass("d-none"),a.rangePreventDuplicatePrices())},rangePreventDuplicatePrices:function(){const t=e(".woo-custom-installments-price-container"),n=t.siblings(".woo-custom-installments-group");t.hasClass("active")&&""!==t.html().trim()?n.addClass("d-none"):(t.removeClass("active"),n.removeClass("d-none"))},updateQuantity:function(){e(document).on("change",'input[name="quantity"]',(function(){i=parseInt(e(this).val())||1,t.tiered_get_rules&&"object"==typeof t.tiered_get_rules&&0!==Object.keys(t.tiered_get_rules).length||a.debounce((()=>{a.updateAmounts(n,i)}),150)}))},updateAmounts:function(e={},t=1){this.executeUpdateAmounts(e,t)},executeUpdateAmounts:function(n={},i=1){t.dev_mode&&console.log("Woo Custom Installments: Updating amounts with price:",n,"and quantity:",i);var o=a.getPriceSelector(),c=i;"yes"===t.update_price_with_quantity&&(c=parseInt(i)||e('input[name="quantity"]').val()),a.updateTableInstallments(n.new_price*c);let r={old_price:n.old_price*c,new_price:n.new_price*c};a.updateMainPriceElement(r);let s=t.discounts.enable_discount_per_unit,l=t.discounts.discount_per_unit_method,d=t.discounts.unit_discount_amount,u=t.discounts.pix_discount,m=t.discounts.pix_discount_method,p=0;if(o.find(".woo-custom-installments-offer").length>0)if("yes"===s){if("percentage"===l){let e=a.getPercentageDiscount(d,n.new_price);p=(n.new_price-e)*c,a.updatePixDiscountElement(e*c)}else if("fixed"===l){let e=n.new_price-d;p=(n.new_price-e)*c,a.updatePixDiscountElement(e*c)}}else if(u)if("percentage"===m){let e=a.getPercentageDiscount(u,n.new_price);p=(n.new_price-e)*c,a.updatePixDiscountElement(e*c)}else if("fixed"===m){let e=n.new_price-u;p=(n.new_price-e)*c,a.updatePixDiscountElement(e*c)}let f=t.discounts.slip_bank_discount,_=t.discounts.slip_bank_method;if(o.find(".woo-custom-installments-ticket-discount").length>0)if("percentage"===_){let e=a.getPercentageDiscount(f,n.new_price)*c;a.updateSlipBankElement(e)}else"fixed"===_&&a.updateSlipBankElement((n.new_price-f)*c);o.find(".woo-custom-installments-economy-pix-badge").length>0&&a.updateEconomyElement(p)},getPriceSelector:function(){const n=e(".woo-custom-installments-price-container"),i=n.siblings(".woo-custom-installments-group");return"simple"===t.product.type?i:"yes"===t.active_price_range?n.hasClass("active")?n:i:0===n.length?e(".woocommerce-variation-price").find(".woo-custom-installments-group"):i},updateMainPriceElement:function(e){let t=a.getPriceSelector();t.find(".woo-custom-installments-price.has-discount").length>0?(e.old_price&&t.find(".woo-custom-installments-price.has-discount").find(".amount").html(a.getFormattedPrice(e.old_price)),e.new_price&&t.find(".woo-custom-installments-price.sale-price").find(".amount").html(a.getFormattedPrice(e.new_price))):e.new_price&&t.find(".woo-custom-installments-price").find(".amount").html(a.getFormattedPrice(e.new_price))},updatePixDiscountElement:function(t){a.getPriceSelector().find(".woo-custom-installments-offer").find(".amount").html(a.getFormattedPrice(t)),e(".wci-popup-body").find(".pix-method-container").find(".amount").html(a.getFormattedPrice(t)),e(".wci-accordion-content").find(".pix-method-container").find(".amount").html(a.getFormattedPrice(t))},updateSlipBankElement:function(t){a.getPriceSelector().find(".woo-custom-installments-ticket-discount").find(".amount").html(a.getFormattedPrice(t)),e(".wci-popup-body").find(".woo-custom-installments-ticket-section").find(".amount").html(a.getFormattedPrice(t)),e(".wci-accordion-content").find(".woo-custom-installments-ticket-section").find(".amount").html(a.getFormattedPrice(t))},updateEconomyElement:function(t){a.getPriceSelector().find(".woo-custom-installments-economy-pix-badge").find(".amount").html(a.getFormattedPrice(t)),e(".wci-popup-body").find(".woo-custom-installments-economy-pix-badge").find(".amount").html(a.getFormattedPrice(t)),e(".wci-accordion-content").find(".woo-custom-installments-economy-pix-badge").find(".amount").html(a.getFormattedPrice(t))},getPercentageDiscount:function(e,t){return t-t*(e/100)},updatedTieredPrice:function(){e(document).on("found_variation show_variation","form.variations_form",(function(e,t){n.old_price=t.display_regular_price,n.new_price=t.display_price})),e(document).on("tiered_price_update",(function(e,t){n.new_price=t.price,a.debounce((()=>{a.updateAmounts(n,t.quantity)}),100)}))},updateTableInstallments:function(n){var i=n,o=e(".woo-custom-installments-table").find("tbody"),c=o.data("default-text");o.html('<tr style="display: none !important;"></tr>');for(var r=1,s=t.installments.fees,l=a.getPriceSelector(),d=t.i18n.best_installments_sp;r<=t.installments.max_installments;){var u,m,p=s.hasOwnProperty(r)?s[r]:t.installments.fee;if(r<=t.installments.max_installments_no_fee){if((u=i/r)<t.installments.min_installment)break;if(c){let e=c.replace("{{ parcelas }}",r).replace("{{ valor }}",a.getFormattedPrice(u)).replace("{{ juros }}",t.i18n.without_fee_label).replace("{{ total }}",a.getFormattedPrice(u*r));o.append('<tr class="no-fee"><th>'+e+"</th><th>"+a.getFormattedPrice(i)+"</th></tr>")}if(d){let e=d.replace("{{ parcelas }}",r).replace("{{ valor }}",a.getFormattedPrice(u)).replace("{{ juros }}",t.i18n.without_fee_label).replace("{{ total }}",a.getFormattedPrice(u*r));l.find(".woo-custom-installments-details.best-value.no-fee").html(e)}}else{if(0===(p=parseFloat(p.toString().replace(",","."))/100))m=i,u=i/r;else if(t.installments.fee!==p)u=(m=i+i*p)/r;else{var f=Math.pow(1+p,r);m=(u=i*p*f/(f-1))*r}if(u<t.installments.min_installment)break;if(c){let e=c.replace("{{ parcelas }}",r).replace("{{ valor }}",a.getFormattedPrice(u)).replace("{{ juros }}",t.i18n.with_fee_label).replace("{{ total }}",a.getFormattedPrice(m));o.append('<tr class="fee-included"><th>'+e+"</th><th>"+a.getFormattedPrice(m)+"</th></tr>")}if(d){let e=d.replace("{{ parcelas }}",r).replace("{{ valor }}",a.getFormattedPrice(u)).replace("{{ juros }}",t.i18n.with_fee_label).replace("{{ total }}",a.getFormattedPrice(m));l.find(".woo-custom-installments-details-with-fee .best-value.fee-included").html(e)}}t.dev_mode&&console.log("Installment calculation:",{count:r,fee:p,value:u,total:m}),r++}},getFormattedPrice:function(e){return"undefined"!=typeof accounting?accounting.formatMoney(e,{symbol:t.currency.symbol,decimal:t.currency.format_decimal_sep,thousand:t.currency.format_thousand_sep,precision:t.currency.format_num_decimals,format:t.currency.format}):t.currency.symbol+e.toFixed(t.currency.format_num_decimals).replace(".",t.currency.format_decimal_sep)},init:function(){this.initAccordion(),this.initModal(),n.old_price=t.product.regular_price,n.new_price=t.product.current_price,"variable"===t.product.type&&e(document).on("found_variation show_variation","form.variations_form",(function(e,t){n.old_price=t.display_regular_price,n.new_price=t.display_price})),"yes"===t.active_price_range&&"simple"!==t.product.type&&this.replaceRangePrice(),"yes"===t.update_price_with_quantity&&this.updateQuantity(),t.check_tiered_plugin&&this.updatedTieredPrice(),t.dev_mode&&console.log("Woo Custom Installments: Plugin initialized with performance optimizations.")}};jQuery(document).ready((function(){a.init()})),window.Woo_Custom_Installments=a,jQuery(document).trigger("woo_custom_installments_ready")}(jQuery);